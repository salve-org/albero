from tree_sitter import Language

from albero import Token, TreeSitterHighlighter, get_lang, get_mapping


def test_basic_usage():
    py_lang: Language = get_lang("java")
    mapping: dict[str, str] = get_mapping("java")

    highlighter = TreeSitterHighlighter()

    highlighter.add_language("java", py_lang, mapping)

    highlighter.add_file(
        "test", "java"
    )  # Trying to add a file with a language not in the system gives an AlberoException

    highlighter.update_file(
        "test", open("tests/test-languages/java_test_file.java").read()
    )  # Trying to update a file not in the system gives an AlberoException

    tokens: list[Token] = highlighter.get_highlights(
        "test"
    )  # Trying to use a file not in the system gives an AlberoException

    assert tokens == [
        ((1, 0), 7, "Keyword"),
        ((1, 8), 3, "Identifier"),
        ((1, 11), 1, "Punctuation"),
        ((1, 12), 7, "Identifier"),
        ((1, 19), 1, "Punctuation"),
        ((3, 0), 6, "Keyword"),
        ((3, 7), 4, "Identifier"),
        ((3, 11), 1, "Punctuation"),
        ((3, 12), 4, "Identifier"),
        ((3, 16), 1, "Punctuation"),
        ((3, 17), 1, "Operator"),
        ((3, 18), 1, "Punctuation"),
        ((3, 21), 19, "Comment"),
        ((5, 0), 3, "Comment"),
        ((6, 1), 25, "Comment"),
        ((7, 1), 2, "Comment"),
        ((9, 0), 6, "Keyword"),
        ((9, 7), 5, "Keyword"),
        ((9, 13), 4, "Identifier"),
        ((9, 18), 1, "Punctuation"),
        ((11, 4), 6, "Keyword"),
        ((11, 11), 6, "Keyword"),
        ((11, 18), 4, "Keyword"),
        ((11, 23), 4, "Identifier"),
        ((11, 27), 1, "Punctuation"),
        ((11, 28), 6, "Identifier"),
        ((11, 34), 2, "Punctuation"),
        ((11, 37), 4, "Identifier"),
        ((11, 41), 1, "Punctuation"),
        ((11, 43), 1, "Punctuation"),
        ((12, 8), 15, "Comment"),
        ((13, 8), 3, "Keyword"),
        ((13, 12), 1, "Identifier"),
        ((13, 14), 1, "Operator"),
        ((13, 16), 1, "Number"),
        ((13, 17), 1, "Punctuation"),
        ((13, 20), 26, "Comment"),
        ((14, 8), 6, "Keyword"),
        ((14, 15), 1, "Identifier"),
        ((14, 17), 1, "Operator"),
        ((14, 19), 3, "Number"),
        ((14, 22), 1, "Punctuation"),
        ((14, 25), 33, "Comment"),
        ((15, 8), 7, "Keyword"),
        ((15, 16), 6, "Identifier"),
        ((15, 23), 1, "Operator"),
        ((15, 25), 4, "Keyword"),
        ((15, 29), 1, "Punctuation"),
        ((15, 32), 27, "Comment"),
        ((16, 8), 7, "Keyword"),
        ((16, 16), 7, "Identifier"),
        ((16, 24), 1, "Operator"),
        ((16, 26), 5, "Keyword"),
        ((16, 31), 1, "Punctuation"),
        ((16, 34), 28, "Comment"),
        ((17, 8), 6, "Identifier"),
        ((17, 15), 3, "Identifier"),
        ((17, 19), 1, "Operator"),
        ((17, 21), 15, "String"),
        ((17, 36), 1, "Punctuation"),
        ((17, 39), 9, "Comment"),
        ((18, 8), 4, "Keyword"),
        ((18, 13), 1, "Identifier"),
        ((18, 15), 1, "Operator"),
        ((18, 17), 3, "String"),
        ((18, 20), 1, "Punctuation"),
        ((18, 23), 20, "Comment"),
        ((19, 8), 4, "Keyword"),
        ((19, 13), 3, "Identifier"),
        ((19, 17), 1, "Operator"),
        ((19, 19), 4, "String"),
        ((19, 23), 1, "Punctuation"),
        ((19, 26), 18, "Comment"),
        ((21, 8), 1, "Identifier"),
        ((21, 10), 2, "Operator"),
        ((21, 13), 1, "Number"),
        ((21, 14), 1, "Punctuation"),
        ((21, 17), 14, "Comment"),
        ((22, 8), 1, "Identifier"),
        ((22, 10), 2, "Operator"),
        ((22, 13), 1, "Number"),
        ((22, 14), 1, "Punctuation"),
        ((22, 17), 14, "Comment"),
        ((23, 8), 1, "Identifier"),
        ((23, 10), 2, "Operator"),
        ((23, 13), 1, "Number"),
        ((23, 14), 1, "Punctuation"),
        ((23, 17), 14, "Comment"),
        ((24, 8), 1, "Identifier"),
        ((24, 10), 2, "Operator"),
        ((24, 13), 1, "Number"),
        ((24, 14), 1, "Punctuation"),
        ((24, 17), 14, "Comment"),
        ((25, 8), 1, "Identifier"),
        ((25, 13), 1, "Number"),
        ((25, 14), 1, "Punctuation"),
        ((25, 17), 13, "Comment"),
        ((26, 8), 1, "Identifier"),
        ((26, 9), 2, "Operator"),
        ((26, 11), 1, "Punctuation"),
        ((26, 14), 14, "Comment"),
        ((27, 8), 1, "Identifier"),
        ((27, 9), 2, "Operator"),
        ((27, 11), 1, "Punctuation"),
        ((27, 14), 14, "Comment"),
        ((29, 8), 2, "Keyword"),
        ((29, 11), 1, "Punctuation"),
        ((29, 12), 1, "Identifier"),
        ((29, 14), 2, "Operator"),
        ((29, 17), 1, "Number"),
        ((29, 18), 1, "Punctuation"),
        ((29, 20), 1, "Punctuation"),
        ((29, 23), 21, "Comment"),
        ((30, 12), 6, "Identifier"),
        ((30, 18), 1, "Punctuation"),
        ((30, 19), 3, "Identifier"),
        ((30, 22), 1, "Punctuation"),
        ((30, 23), 7, "Identifier"),
        ((30, 30), 1, "Punctuation"),
        ((30, 31), 12, "String"),
        ((30, 43), 2, "Punctuation"),
        ((30, 47), 14, "Comment"),
        ((31, 8), 1, "Punctuation"),
        ((31, 10), 4, "Keyword"),
        ((31, 15), 2, "Keyword"),
        ((31, 18), 1, "Punctuation"),
        ((31, 19), 1, "Identifier"),
        ((31, 21), 2, "Operator"),
        ((31, 24), 1, "Number"),
        ((31, 25), 1, "Punctuation"),
        ((31, 27), 1, "Punctuation"),
        ((31, 30), 26, "Comment"),
        ((32, 12), 6, "Identifier"),
        ((32, 18), 1, "Punctuation"),
        ((32, 19), 3, "Identifier"),
        ((32, 22), 1, "Punctuation"),
        ((32, 23), 7, "Identifier"),
        ((32, 30), 1, "Punctuation"),
        ((32, 31), 16, "String"),
        ((32, 47), 2, "Punctuation"),
        ((33, 8), 1, "Punctuation"),
        ((33, 10), 4, "Keyword"),
        ((33, 15), 1, "Punctuation"),
        ((33, 18), 15, "Comment"),
        ((34, 12), 6, "Identifier"),
        ((34, 18), 1, "Punctuation"),
        ((34, 19), 3, "Identifier"),
        ((34, 22), 1, "Punctuation"),
        ((34, 23), 7, "Identifier"),
        ((34, 30), 1, "Punctuation"),
        ((34, 31), 16, "String"),
        ((34, 47), 2, "Punctuation"),
        ((35, 8), 1, "Punctuation"),
        ((37, 8), 5, "Keyword"),
        ((37, 14), 1, "Punctuation"),
        ((37, 15), 1, "Identifier"),
        ((37, 17), 1, "Operator"),
        ((37, 19), 2, "Number"),
        ((37, 21), 1, "Punctuation"),
        ((37, 23), 1, "Punctuation"),
        ((37, 26), 23, "Comment"),
        ((38, 12), 1, "Identifier"),
        ((38, 13), 2, "Operator"),
        ((38, 15), 1, "Punctuation"),
        ((38, 18), 12, "Comment"),
        ((39, 8), 1, "Punctuation"),
        ((41, 8), 3, "Keyword"),
        ((41, 12), 1, "Punctuation"),
        ((41, 13), 3, "Keyword"),
        ((41, 17), 1, "Identifier"),
        ((41, 19), 1, "Operator"),
        ((41, 21), 1, "Number"),
        ((41, 22), 1, "Punctuation"),
        ((41, 24), 1, "Identifier"),
        ((41, 26), 1, "Operator"),
        ((41, 28), 2, "Number"),
        ((41, 30), 1, "Punctuation"),
        ((41, 32), 1, "Identifier"),
        ((41, 33), 2, "Operator"),
        ((41, 35), 1, "Punctuation"),
        ((41, 37), 1, "Punctuation"),
        ((41, 40), 26, "Comment"),
        ((42, 12), 6, "Identifier"),
        ((42, 18), 1, "Punctuation"),
        ((42, 19), 3, "Identifier"),
        ((42, 22), 1, "Punctuation"),
        ((42, 23), 7, "Identifier"),
        ((42, 30), 1, "Punctuation"),
        ((42, 31), 1, "Identifier"),
        ((42, 32), 2, "Punctuation"),
        ((42, 36), 14, "Comment"),
        ((43, 8), 1, "Punctuation"),
        ((45, 8), 3, "Keyword"),
        ((45, 12), 1, "Punctuation"),
        ((45, 15), 14, "Comment"),
        ((46, 12), 5, "Keyword"),
        ((46, 18), 3, "Keyword"),
        ((46, 22), 9, "Identifier"),
        ((46, 31), 1, "Punctuation"),
        ((46, 32), 8, "String"),
        ((46, 40), 2, "Punctuation"),
        ((46, 44), 24, "Comment"),
        ((47, 8), 1, "Punctuation"),
        ((47, 10), 5, "Keyword"),
        ((47, 16), 1, "Punctuation"),
        ((47, 17), 9, "Identifier"),
        ((47, 27), 1, "Identifier"),
        ((47, 28), 1, "Punctuation"),
        ((47, 30), 1, "Punctuation"),
        ((47, 33), 16, "Comment"),
        ((48, 12), 1, "Identifier"),
        ((48, 13), 1, "Punctuation"),
        ((48, 14), 15, "Identifier"),
        ((48, 29), 3, "Punctuation"),
        ((48, 34), 14, "Comment"),
        ((49, 8), 1, "Punctuation"),
        ((49, 10), 7, "Keyword"),
        ((49, 18), 1, "Punctuation"),
        ((49, 21), 18, "Comment"),
        ((50, 12), 6, "Identifier"),
        ((50, 18), 1, "Punctuation"),
        ((50, 19), 3, "Identifier"),
        ((50, 22), 1, "Punctuation"),
        ((50, 23), 7, "Identifier"),
        ((50, 30), 1, "Punctuation"),
        ((50, 31), 15, "String"),
        ((50, 46), 2, "Punctuation"),
        ((51, 8), 1, "Punctuation"),
        ((53, 8), 6, "Keyword"),
        ((53, 15), 1, "Identifier"),
        ((53, 17), 2, "Operator"),
        ((53, 20), 2, "Number"),
        ((53, 22), 1, "Punctuation"),
        ((53, 25), 33, "Comment"),
        ((55, 8), 6, "Keyword"),
        ((55, 15), 1, "Punctuation"),
        ((55, 16), 1, "Identifier"),
        ((55, 17), 1, "Punctuation"),
        ((55, 19), 1, "Punctuation"),
        ((56, 12), 4, "Keyword"),
        ((56, 17), 2, "Number"),
        ((56, 19), 1, "Punctuation"),
        ((56, 22), 15, "Comment"),
        ((57, 16), 6, "Identifier"),
        ((57, 22), 1, "Punctuation"),
        ((57, 23), 3, "Identifier"),
        ((57, 26), 1, "Punctuation"),
        ((57, 27), 7, "Identifier"),
        ((57, 34), 1, "Punctuation"),
        ((57, 35), 9, "String"),
        ((57, 44), 2, "Punctuation"),
        ((58, 16), 5, "Keyword"),
        ((58, 21), 1, "Punctuation"),
        ((58, 24), 16, "Comment"),
        ((59, 12), 7, "Keyword"),
        ((59, 19), 1, "Punctuation"),
        ((60, 16), 6, "Identifier"),
        ((60, 22), 1, "Punctuation"),
        ((60, 23), 3, "Identifier"),
        ((60, 26), 1, "Punctuation"),
        ((60, 27), 7, "Identifier"),
        ((60, 34), 1, "Punctuation"),
        ((60, 35), 14, "String"),
        ((60, 49), 2, "Punctuation"),
        ((61, 16), 5, "Keyword"),
        ((61, 21), 1, "Punctuation"),
        ((62, 8), 1, "Punctuation"),
        ((64, 8), 7, "Keyword"),
        ((64, 16), 9, "Identifier"),
        ((64, 26), 1, "Operator"),
        ((64, 28), 1, "Identifier"),
        ((64, 30), 1, "Operator"),
        ((64, 32), 1, "Number"),
        ((64, 34), 2, "Operator"),
        ((64, 37), 1, "Identifier"),
        ((64, 39), 1, "Operator"),
        ((64, 41), 2, "Number"),
        ((64, 43), 1, "Punctuation"),
        ((64, 46), 24, "Comment"),
        ((65, 8), 7, "Keyword"),
        ((65, 16), 11, "Identifier"),
        ((65, 28), 1, "Operator"),
        ((65, 30), 1, "Identifier"),
        ((65, 32), 1, "Operator"),
        ((65, 34), 1, "Number"),
        ((65, 36), 2, "Operator"),
        ((65, 39), 1, "Identifier"),
        ((65, 41), 1, "Operator"),
        ((65, 43), 2, "Number"),
        ((65, 45), 1, "Punctuation"),
        ((65, 48), 14, "Comment"),
        ((67, 8), 4, "Identifier"),
        ((67, 13), 4, "Identifier"),
        ((67, 18), 1, "Operator"),
        ((67, 20), 3, "Keyword"),
        ((67, 24), 4, "Identifier"),
        ((67, 28), 3, "Punctuation"),
        ((68, 8), 4, "Identifier"),
        ((68, 12), 1, "Punctuation"),
        ((68, 13), 13, "Identifier"),
        ((68, 26), 3, "Punctuation"),
        ((69, 4), 1, "Punctuation"),
        ((71, 4), 6, "Keyword"),
        ((71, 11), 4, "Keyword"),
        ((71, 16), 13, "Identifier"),
        ((71, 29), 2, "Punctuation"),
        ((71, 32), 1, "Punctuation"),
        ((72, 8), 5, "Keyword"),
        ((72, 13), 1, "Punctuation"),
        ((72, 14), 8, "Identifier"),
        ((72, 22), 3, "Punctuation"),
        ((72, 27), 16, "Comment"),
        ((73, 8), 4, "Keyword"),
        ((73, 12), 1, "Punctuation"),
        ((73, 13), 8, "Identifier"),
        ((73, 21), 3, "Punctuation"),
        ((73, 26), 15, "Comment"),
        ((74, 4), 1, "Punctuation"),
        ((76, 4), 6, "Keyword"),
        ((76, 11), 9, "Keyword"),
        ((76, 21), 16, "Identifier"),
        ((76, 38), 1, "Punctuation"),
        ((76, 41), 20, "Comment"),
        ((77, 8), 4, "Keyword"),
        ((77, 13), 7, "Identifier"),
        ((77, 20), 3, "Punctuation"),
        ((77, 25), 22, "Comment"),
        ((78, 4), 1, "Punctuation"),
        ((80, 4), 6, "Keyword"),
        ((80, 11), 8, "Keyword"),
        ((80, 20), 5, "Keyword"),
        ((80, 26), 20, "Identifier"),
        ((80, 47), 1, "Punctuation"),
        ((80, 50), 17, "Comment"),
        ((81, 8), 6, "Keyword"),
        ((81, 15), 8, "Keyword"),
        ((81, 24), 4, "Keyword"),
        ((81, 29), 7, "Identifier"),
        ((81, 36), 3, "Punctuation"),
        ((81, 41), 18, "Comment"),
        ((82, 4), 1, "Punctuation"),
        ((84, 4), 6, "Keyword"),
        ((84, 11), 5, "Keyword"),
        ((84, 17), 12, "Identifier"),
        ((84, 30), 7, "Keyword"),
        ((84, 38), 20, "Identifier"),
        ((84, 59), 10, "Keyword"),
        ((84, 70), 16, "Identifier"),
        ((84, 87), 1, "Punctuation"),
        ((84, 90), 38, "Comment"),
        ((85, 8), 1, "Operator"),
        ((85, 9), 8, "Identifier"),
        ((86, 8), 6, "Keyword"),
        ((86, 15), 4, "Keyword"),
        ((86, 20), 7, "Identifier"),
        ((86, 27), 2, "Punctuation"),
        ((86, 30), 1, "Punctuation"),
        ((86, 33), 23, "Comment"),
        ((87, 12), 24, "Comment"),
        ((88, 8), 1, "Punctuation"),
        ((89, 4), 1, "Punctuation"),
        ((91, 4), 7, "Keyword"),
        ((91, 12), 5, "Keyword"),
        ((91, 18), 3, "Keyword"),
        ((91, 22), 15, "Identifier"),
        ((91, 38), 1, "Operator"),
        ((91, 40), 1, "Number"),
        ((91, 41), 1, "Punctuation"),
        ((91, 44), 26, "Comment"),
        ((92, 4), 9, "Keyword"),
        ((92, 14), 6, "Keyword"),
        ((92, 21), 3, "Keyword"),
        ((92, 25), 18, "Identifier"),
        ((92, 44), 1, "Operator"),
        ((92, 46), 1, "Number"),
        ((92, 47), 1, "Punctuation"),
        ((92, 50), 29, "Comment"),
        ((93, 4), 6, "Keyword"),
        ((93, 11), 3, "Keyword"),
        ((93, 15), 9, "Identifier"),
        ((93, 25), 1, "Operator"),
        ((93, 27), 1, "Number"),
        ((93, 28), 1, "Punctuation"),
        ((93, 31), 17, "Comment"),
        ((95, 4), 6, "Keyword"),
        ((95, 11), 4, "Keyword"),
        ((95, 16), 10, "Identifier"),
        ((95, 26), 2, "Punctuation"),
        ((95, 29), 1, "Punctuation"),
        ((96, 8), 6, "Keyword"),
        ((96, 14), 1, "Punctuation"),
        ((96, 17), 17, "Comment"),
        ((97, 4), 1, "Punctuation"),
        ((99, 4), 6, "Keyword"),
        ((99, 11), 3, "Keyword"),
        ((99, 15), 9, "Identifier"),
        ((99, 24), 2, "Punctuation"),
        ((99, 27), 1, "Punctuation"),
        ((100, 8), 6, "Keyword"),
        ((100, 15), 1, "Number"),
        ((100, 16), 1, "Punctuation"),
        ((100, 19), 28, "Comment"),
        ((101, 4), 1, "Punctuation"),
        ((103, 4), 7, "Keyword"),
        ((103, 12), 12, "Identifier"),
        ((103, 25), 1, "Operator"),
        ((103, 27), 1, "Operator"),
        ((103, 28), 6, "Identifier"),
        ((103, 34), 1, "Punctuation"),
        ((103, 37), 13, "Comment"),
        ((104, 4), 7, "Keyword"),
        ((104, 12), 16, "Identifier"),
        ((104, 29), 1, "Operator"),
        ((104, 31), 1, "Punctuation"),
        ((104, 32), 1, "Identifier"),
        ((104, 34), 2, "Operator"),
        ((104, 37), 2, "Number"),
        ((104, 39), 1, "Punctuation"),
        ((104, 41), 1, "Operator"),
        ((104, 43), 4, "Keyword"),
        ((104, 48), 1, "Punctuation"),
        ((104, 50), 5, "Keyword"),
        ((104, 55), 1, "Punctuation"),
        ((104, 58), 23, "Comment"),
        ((106, 4), 3, "Keyword"),
        ((106, 7), 2, "Punctuation"),
        ((106, 10), 5, "Identifier"),
        ((106, 16), 1, "Operator"),
        ((106, 18), 3, "Keyword"),
        ((106, 22), 3, "Keyword"),
        ((106, 25), 3, "Punctuation"),
        ((106, 28), 1, "Number"),
        ((106, 29), 1, "Punctuation"),
        ((106, 31), 1, "Number"),
        ((106, 32), 1, "Punctuation"),
        ((106, 34), 1, "Number"),
        ((106, 35), 2, "Punctuation"),
        ((106, 39), 24, "Comment"),
        ((107, 0), 1, "Punctuation"),
    ]
