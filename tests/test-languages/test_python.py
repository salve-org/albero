from tree_sitter import Language

from albero import Token, TreeSitterHighlighter, get_lang, get_mapping


def test_basic_usage():
    py_lang: Language = get_lang("python")
    mapping: dict[str, str] = get_mapping("python")

    highlighter = TreeSitterHighlighter()

    highlighter.add_language("python", py_lang, mapping)

    highlighter.add_file(
        "test", "python"
    )  # Trying to add a file with a language not in the system gives an AlberoException

    highlighter.update_file(
        "test", open("tests/test-languages/python_test_file.py").read()
    )  # Trying to update a file not in the system gives an AlberoException

    tokens: list[Token] = highlighter.get_highlights(
        "test"
    )  # Trying to use a file not in the system gives an AlberoException

    assert tokens == [
        ((1, 0), 4, "Keyword"),
        ((1, 5), 6, "Identifier"),
        ((1, 12), 6, "Keyword"),
        ((1, 19), 3, "Identifier"),
        ((3, 0), 4, "Keyword"),
        ((3, 5), 3, "Identifier"),
        ((3, 9), 6, "Keyword"),
        ((3, 16), 3, "Identifier"),
        ((3, 20), 2, "Keyword"),
        ((3, 23), 3, "Identifier"),
        ((3, 28), 12, "Comment"),
        ((5, 0), 17, "Comment"),
        ((7, 0), 24, "Comment"),
        ((8, 0), 1, "Identifier"),
        ((8, 2), 1, "Operator"),
        ((8, 4), 1, "Punctuation"),
        ((8, 5), 3, "String"),
        ((8, 8), 1, "Punctuation"),
        ((8, 10), 1, "String"),
        ((8, 12), 3, "String"),
        ((8, 15), 1, "Punctuation"),
        ((8, 18), 29, "Comment"),
        ((9, 0), 1, "Identifier"),
        ((9, 2), 1, "Operator"),
        ((9, 4), 3, "Number"),
        ((9, 9), 7, "Comment"),
        ((10, 0), 1, "Identifier"),
        ((10, 2), 1, "Operator"),
        ((10, 4), 2, "Punctuation"),
        ((10, 8), 6, "Comment"),
        ((11, 0), 1, "Identifier"),
        ((11, 2), 1, "Operator"),
        ((11, 4), 1, "Number"),
        ((11, 7), 9, "Comment"),
        ((12, 0), 1, "Identifier"),
        ((12, 2), 1, "Operator"),
        ((12, 4), 3, "Identifier"),
        ((12, 7), 1, "Punctuation"),
        ((12, 8), 3, "String"),
        ((12, 11), 1, "Punctuation"),
        ((12, 14), 21, "Comment"),
        ((13, 0), 1, "Identifier"),
        ((13, 2), 1, "Operator"),
        ((13, 4), 6, "Keyword"),
        ((13, 10), 1, "Punctuation"),
        ((13, 12), 5, "Identifier"),
        ((13, 19), 30, "Comment"),
        ((15, 0), 20, "Comment"),
        ((16, 0), 2, "Keyword"),
        ((16, 3), 1, "Identifier"),
        ((16, 5), 2, "Operator"),
        ((16, 8), 1, "Number"),
        ((16, 9), 1, "Punctuation"),
        ((16, 12), 14, "Comment"),
        ((17, 4), 1, "Identifier"),
        ((17, 6), 2, "Operator"),
        ((17, 9), 1, "Number"),
        ((17, 11), 1, "Operator"),
        ((17, 13), 1, "Identifier"),
        ((17, 16), 34, "Comment"),
        ((18, 4), 1, "Identifier"),
        ((18, 6), 2, "Operator"),
        ((18, 9), 1, "Number"),
        ((18, 11), 1, "Operator"),
        ((18, 13), 1, "Identifier"),
        ((18, 16), 37, "Comment"),
        ((19, 4), 1, "Identifier"),
        ((19, 6), 2, "Operator"),
        ((19, 9), 1, "Number"),
        ((19, 11), 1, "Operator"),
        ((19, 13), 1, "Identifier"),
        ((19, 16), 40, "Comment"),
        ((20, 4), 1, "Identifier"),
        ((20, 6), 2, "Operator"),
        ((20, 9), 1, "Number"),
        ((20, 11), 1, "Operator"),
        ((20, 13), 1, "Identifier"),
        ((20, 16), 34, "Comment"),
        ((21, 4), 1, "Identifier"),
        ((21, 6), 3, "Operator"),
        ((21, 10), 1, "Number"),
        ((21, 11), 2, "Operator"),
        ((21, 13), 1, "Identifier"),
        ((21, 16), 40, "Comment"),
        ((22, 4), 2, "Keyword"),
        ((22, 7), 1, "Identifier"),
        ((22, 9), 2, "Keyword"),
        ((22, 12), 3, "Keyword"),
        ((22, 16), 4, "Keyword"),
        ((22, 20), 1, "Punctuation"),
        ((22, 23), 8, "Comment"),
        ((23, 8), 4, "Keyword"),
        ((23, 14), 16, "Comment"),
        ((24, 4), 4, "Keyword"),
        ((24, 9), 1, "Identifier"),
        ((24, 11), 2, "Keyword"),
        ((24, 14), 4, "Keyword"),
        ((24, 18), 1, "Punctuation"),
        ((24, 21), 13, "Comment"),
        ((25, 8), 4, "Keyword"),
        ((26, 4), 4, "Keyword"),
        ((26, 8), 1, "Punctuation"),
        ((26, 11), 6, "Comment"),
        ((27, 8), 4, "Keyword"),
        ((29, 0), 22, "Comment"),
        ((30, 0), 5, "Keyword"),
        ((30, 6), 1, "Identifier"),
        ((30, 7), 1, "Punctuation"),
        ((31, 4), 4, "Keyword"),
        ((31, 9), 1, "Number"),
        ((31, 10), 1, "Punctuation"),
        ((31, 13), 6, "Comment"),
        ((32, 8), 5, "Identifier"),
        ((32, 13), 1, "Punctuation"),
        ((32, 14), 6, "String"),
        ((32, 20), 1, "Punctuation"),
        ((33, 4), 4, "Keyword"),
        ((33, 9), 1, "Keyword"),
        ((33, 10), 1, "Punctuation"),
        ((33, 13), 8, "Comment"),
        ((34, 8), 5, "Identifier"),
        ((34, 13), 1, "Punctuation"),
        ((34, 14), 6, "String"),
        ((34, 20), 1, "Punctuation"),
        ((36, 0), 32, "Comment"),
        ((37, 0), 5, "Keyword"),
        ((37, 6), 1, "Number"),
        ((37, 8), 2, "Keyword"),
        ((37, 11), 1, "Identifier"),
        ((37, 12), 1, "Punctuation"),
        ((37, 15), 13, "Comment"),
        ((38, 4), 5, "Keyword"),
        ((39, 0), 2, "Keyword"),
        ((39, 3), 1, "Number"),
        ((39, 5), 3, "Keyword"),
        ((39, 9), 2, "Keyword"),
        ((39, 12), 1, "Identifier"),
        ((39, 13), 1, "Punctuation"),
        ((39, 16), 17, "Comment"),
        ((40, 4), 4, "Keyword"),
        ((43, 0), 25, "Comment"),
        ((44, 0), 3, "Keyword"),
        ((44, 4), 9, "Identifier"),
        ((44, 13), 1, "Punctuation"),
        ((44, 14), 3, "Identifier"),
        ((44, 17), 1, "Punctuation"),
        ((44, 19), 2, "Operator"),
        ((44, 22), 3, "Identifier"),
        ((44, 25), 1, "Punctuation"),
        ((44, 28), 35, "Comment"),
        ((45, 4), 3, "Keyword"),
        ((45, 8), 7, "Identifier"),
        ((45, 15), 3, "Punctuation"),
        ((45, 20), 17, "Comment"),
        ((46, 8), 6, "Keyword"),
        ((46, 15), 3, "Identifier"),
        ((46, 18), 2, "Punctuation"),
        ((46, 22), 18, "Comment"),
        ((48, 4), 6, "Keyword"),
        ((48, 11), 7, "Identifier"),
        ((51, 0), 10, "Identifier"),
        ((52, 0), 3, "Keyword"),
        ((52, 4), 7, "Identifier"),
        ((52, 11), 3, "Punctuation"),
        ((53, 4), 2, "Keyword"),
        ((53, 7), 1, "Identifier"),
        ((53, 9), 1, "Operator"),
        ((53, 11), 1, "Identifier"),
        ((53, 12), 1, "Punctuation"),
        ((53, 15), 14, "Comment"),
        ((54, 8), 4, "Keyword"),
        ((55, 4), 2, "Keyword"),
        ((55, 7), 1, "Identifier"),
        ((55, 9), 2, "Operator"),
        ((55, 12), 1, "Identifier"),
        ((55, 13), 1, "Punctuation"),
        ((55, 16), 23, "Comment"),
        ((56, 8), 4, "Keyword"),
        ((57, 4), 2, "Keyword"),
        ((57, 7), 1, "Identifier"),
        ((57, 9), 1, "Operator"),
        ((57, 11), 1, "Identifier"),
        ((57, 12), 1, "Punctuation"),
        ((57, 15), 11, "Comment"),
        ((58, 8), 4, "Keyword"),
        ((59, 4), 2, "Keyword"),
        ((59, 7), 1, "Identifier"),
        ((59, 9), 2, "Operator"),
        ((59, 12), 1, "Identifier"),
        ((59, 13), 1, "Punctuation"),
        ((59, 16), 20, "Comment"),
        ((60, 8), 4, "Keyword"),
        ((61, 4), 3, "Operator"),
        ((62, 4), 2, "Keyword"),
        ((62, 7), 1, "Identifier"),
        ((62, 9), 2, "Operator"),
        ((62, 12), 1, "Identifier"),
        ((62, 13), 1, "Punctuation"),
        ((62, 16), 12, "Comment"),
        ((63, 8), 4, "Keyword"),
        ((64, 4), 4, "Keyword"),
        ((64, 9), 4, "Identifier"),
        ((64, 13), 1, "Punctuation"),
        ((64, 14), 9, "String"),
        ((64, 23), 1, "Punctuation"),
        ((64, 25), 2, "Keyword"),
        ((64, 28), 1, "Identifier"),
        ((64, 29), 1, "Punctuation"),
        ((64, 32), 43, "Comment"),
        ((65, 8), 6, "Keyword"),
        ((65, 15), 5, "Keyword"),
        ((65, 21), 2, "Operator"),
        ((65, 24), 5, "Keyword"),
        ((65, 31), 45, "Comment"),
        ((66, 8), 6, "Keyword"),
        ((66, 15), 4, "Keyword"),
        ((66, 20), 2, "Operator"),
        ((66, 23), 4, "Keyword"),
        ((66, 29), 12, "Comment"),
        ((67, 8), 4, "Keyword"),
        ((70, 0), 19, "Comment"),
        ((71, 0), 5, "Keyword"),
        ((71, 6), 3, "Identifier"),
        ((71, 9), 1, "Punctuation"),
        ((72, 4), 3, "Keyword"),
        ((72, 8), 10, "Identifier"),
        ((72, 18), 1, "Punctuation"),
        ((72, 19), 4, "Identifier"),
        ((72, 23), 2, "Punctuation"),
        ((73, 8), 5, "Keyword"),
        ((73, 14), 9, "Identifier"),
        ((73, 23), 1, "Punctuation"),
        ((73, 24), 4, "String"),
        ((73, 28), 1, "Punctuation"),
        ((73, 31), 17, "Comment"),
        ((76, 0), 33, "Comment"),
        ((77, 0), 3, "Keyword"),
        ((77, 4), 1, "Identifier"),
        ((77, 6), 2, "Keyword"),
        ((77, 9), 5, "Identifier"),
        ((77, 14), 1, "Punctuation"),
        ((77, 15), 1, "Identifier"),
        ((77, 16), 2, "Punctuation"),
        ((78, 4), 8, "Keyword"),
        ((80, 0), 34, "Comment"),
        ((81, 0), 1, "Identifier"),
        ((81, 2), 1, "Operator"),
        ((81, 4), 2, "Punctuation"),
        ((81, 7), 1, "Operator"),
        ((81, 9), 2, "Punctuation"),
        ((81, 13), 27, "Comment"),
        ((83, 0), 26, "Comment"),
        ((84, 0), 3, "Keyword"),
        ((84, 3), 1, "Punctuation"),
        ((85, 4), 4, "Keyword"),
        ((86, 0), 6, "Keyword"),
        ((86, 6), 1, "Punctuation"),
        ((86, 9), 27, "Comment"),
        ((87, 4), 4, "Keyword"),
        ((88, 0), 7, "Number"),
        ((88, 7), 1, "Punctuation"),
        ((88, 10), 9, "Comment"),
        ((89, 4), 4, "Keyword"),
        ((91, 0), 14, "Error"),
        ((91, 0), 3, "Keyword"),
        ((91, 4), 10, "Identifier"),
    ]
